define(["require","jquery","system","msgBox","constants","researchHelper","lazyRequire","person","dateProblems","dateProblemsReport","retrieve","findPerson","retrieve"],function(e){function h(){a.id&&t("#dateProblemsPersonId").val(a.id),a.researchType&&t("#dateProblemsResearchType").val(a.researchType),a.generation&&t("#dateProblemsGeneration").val(a.generation),f.empty&&t("#dateProblemsEmpty").prop("checked",f.empty),f.invalid&&t("#dateProblemsInvalid").prop("checked",f.invalid),f.invalidFormat&&t("#dateProblemsInvalidFormat").prop("checked",f.invalidFormat),f.incomplete&&t("#dateProblemsIncomplete").prop("checked",f.incomplete),a.reportId&&t("#dateProblemsReportId").val(a.reportId),a.addChildren&&t("#addChildren").prop("checked",a.addChildren)}function p(e){var n=t('<select class="form-control select1Digit" id="dateProblemsGeneration">');t.each(e,function(e,r){n.append(t("<option/>").attr("value",r).text(r))}),t("#dateProblemsGenerationDiv").empty(),t("#dateProblemsGenerationDiv").append(n),t("#dateProblemsGenerationDiv").nextAll().remove(),a.researchType==="Ancestors"&&a.reportId===i.REPORT_ID&&t("#dateProblemsGenerationDiv").after('<span class="input-group-btn"><input id="addChildren" type="checkbox" style="vertical-align: middle; margin-top: -0.625em; margin-left: .7em;"/></span><label for="addChildren" style="vertical-align: middle; margin-top: -1.4em">&nbsp;<span style="font-weight: normal">Add Children</span></label>'),t("#dateProblemsGeneration").change(function(e){var n=t("#dateProblemsGeneration").val();a.researchType===i.DESCENDANTS?n>1&&r.warning("Selecting two generations of Descendants will more than double the time to retrieve descendants."):n>a.generation&&r.warning("Increasing the number of generations will increase the time to retrieve ancestors."),a.generation=t("#dateProblemsGeneration").val(),a.resetReportId(t("#dateProblemsReportId"))})}function d(){var e=[];e[0]="1",e[1]="2",e[2]="3",p(e),t("#dateProblemsGeneration").val(a.generation)}function v(){var e=[];e[0]="2",e[1]="3",e[2]="4",e[3]="5",e[4]="6",e[5]="7",e[6]="8",p(e),t("#dateProblemsGeneration").val(a.generation)}function m(){t("#dateProblemsReportId").val(a.reportId);var e=t("#dateProblemsReportId option:selected").text();if(e&&e.length>8&&e!=="Select"){var n=e.indexOf("Name: ")+6,r=e.indexOf(", Date:  "),s=e.indexOf(", Research Type: "),o=e.indexOf(",  Generations: ");a.id=e.substring(n,n+8),a.name=e.substring(n+11,r),a.researchType=e.substring(s+17,o),a.generation=e.substring(o+16,o+17),a.loadPersons(t("#dateProblemsPersonId"))}a.researchType===i.DESCENDANTS?d():v(),h()}function g(e){c.loadReports(t("#dateProblemsReportId"),e),m()}function y(){a.researchType!==i.ANCESTORS&&(a.generation="2"),t("dateProblemsGeneration").val(a.generation)}function b(){f.form=t("#dateProblemsForm"),x(),g(),a.loadPersons(t("#dateProblemsPersonId")),h(),n.openForm(f.form,f.formTitleImage,f.spinner)}function w(){a.clear()}function E(){a.reset(),m()}function S(){a.resetReportId(t("#dateProblemsReportId")),m()}function x(){t("#dateProblemsPerson").change(function(e){debugger}),t("#dateProblemsReportId").change(function(e){a.reportId=t("#dateProblemsReportId option:selected").val(),a.reportId===i.REPORT_ID&&r.warning('Even though the "Select" option is availiable to retrieve family search data, to avoid performance problems it is best practice to first retrieve the data before analyzing.'),m()}),t("#dateProblemsPersonId").change(function(e){a.id=t("option:selected",t(this)).val(),a.name=t("option:selected",t(this)).text(),S()}),t("#dateProblemsResearchType").change(function(e){a.researchType=t("#dateProblemsResearchType").val(),a.researchType===i.DESCENDANTS?(a.generationAncestors=a.generation,a.generation=a.generationDescendants,d()):(a.generationDescendants=a.generation,a.generation=a.generationAncestors,v()),y(),S()}),t("#dateProblemsFindPersonButton").unbind("click").bind("click",function(n){return s.findPerson(n,function(n){var r=e("findPerson");if(n){var i=r.id===t("#dateProblemsPersonId").val()?!1:!0;i&&(a.id=r.id,a.name=r.name),f.save(),a.loadPersons(t("#dateProblemsPersonId")),i&&S()}r.reset()}),!1}),t("#dateProblemsRetrieveButton").unbind("click").bind("click",function(t){return s.retrieve(function(t){var n=e("retrieve");t&&(a.reportId=n.reportId,f.save(),g(!0)),n.reset()}),!1}),t("#dateProblemsHelpButton").unbind("click").bind("click",function(e){}),t("#dateProblemsCloseButton").unbind("click").bind("click",function(e){f.form.dialog(i.CLOSE)}),t("#dateProblemsResetButton").unbind("click").bind("click",function(e){E()}),t("#dateProblemsPreviousButton").unbind("click").bind("click",function(e){f.previous||window.localStorage&&(f.previous=JSON.parse(localStorage.getItem(i.DATE_PROBLEMS_PREVIOUS))),f.previous?(n.initSpinner(f.spinner),f.callerSpinner=f.spinner,t.ajax({url:i.DATE_PROBLEMS_REPORT_HTML_URL,success:function(e){var n=t("#dateProblemsReportForm"),r=n.children().detach();t('<div id="dateProblemsReportForm"></div>').dialog({title:"Date Problems",width:975,open:function(){r.appendTo(n),t(this).css("maxHeight",700)}}),f.displayType="previous",t("#dateProblemsReportForm").empty().append(e),s&&s.dateProblemsReportController&&s.dateProblemsReportController.open()}})):r.message("Sorry, there is nothing previous to display.")}),t("#dateProblemsSubmitButton").unbind("click").bind("click",function(e){return n.isAuthenticated()?(a.id||r.message("You must first select a person from Family Search"),r.question("Depending on the number of generations you selected, this could take a minute or two.  Select Yes if you want to contine.","Question",function(e){e&&u(["jqueryUiOptions","css!/Content/css/lib/research/bootstrap-table.min.css"],function(){},function(){n.initSpinner(f.spinner),f.callerSpinner=f.spinner,t.ajax({url:i.DATE_PROBLEMS_REPORT_HTML_URL,success:function(e){var n=t("#dateProblemsReportForm"),r=n.children().detach();t('<div id="dateProblemsReportForm"></div>').dialog({title:"Date Problems",width:975,height:515,open:function(){r.appendTo(n)}}),l.displayType="start",f.save(),t("#dateProblemsReportForm").empty().append(e),s&&s.dateProblemsReportController&&s.dateProblemsReportController.open()}})})})):(l.form.dialog("close"),n.relogin()),!1}),t("#addChildren").change(function(e){a.addChildren=t("#addChildren").prop("checked"),a.addChildren&&r.warning("Selecting <b>Add Children</b> check box will probably double the time to retrieve ancestors."),a.resetReportId(t("#dateProblemsReportId")),m()}),t("#dateProblemsEmpty").change(function(e){f.empty=t("#dateProblemsEmpty").prop("checked")}),t("#dateProblemsInvalid").change(function(e){f.invalid=t("#dateProblemsInvalid").prop("checked")}),t("#dateProblemsInvalidFormat").change(function(e){f.invalidFormat=t("#dateProblemsInvalidFormat").prop("checked")}),t("#dateProblemsIncomplete").change(function(e){f.incomplete=t("#dateProblemsIncomplete").prop("checked")}),t("#dateProblemsCancelButton").unbind("click").bind("click",function(e){f.form.dialog(i.CLOSE)}),f.form.unbind(i.DIALOG_CLOSE).bind(i.DIALOG_CLOSE,function(e){f.save()})}var t=e("jquery"),n=e("system"),r=e("msgBox"),i=e("constants"),s=e("researchHelper"),o=e("lazyRequire"),u=o.once(),a=e("person"),f=e("dateProblems"),l=e("dateProblemsReport"),c=e("retrieve"),T={open:function(){b()}};return s.dateProblemsController=T,b(),T});