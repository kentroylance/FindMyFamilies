define(["require","jquery","system","msgBox","constants","researchHelper","lazyRequire","person","incompleteOrdinances","incompleteOrdinancesReport","retrieve","findPerson","retrieve"],function(t){function p(){f.id&&n("#incompleteOrdinancesPersonId").val(f.id),f.researchType&&n("#incompleteOrdinancesResearchType").val(f.researchType),f.generation&&n("#incompleteOrdinancesGeneration").val(f.generation),f.reportId&&n("#incompleteOrdinancesReportId").val(f.reportId),f.addChildren&&n("#addChildren").prop("checked",f.addChildren)}function d(e){var t=n('<select class="form-control select1Digit" id="incompleteOrdinancesGeneration">');n.each(e,function(e,r){t.append(n("<option/>").attr("value",r).text(r))}),n("#incompleteOrdinancesGenerationDiv").empty(),n("#incompleteOrdinancesGenerationDiv").append(t),n("#incompleteOrdinancesGenerationDiv").nextAll().remove(),f.researchType==="Ancestors"&&f.reportId===s.REPORT_ID&&n("#incompleteOrdinancesGenerationDiv").after('<span class="input-group-btn"><input id="addChildren" type="checkbox" style="vertical-align: middle; margin-top: -0.625em; margin-left: .7em;"/></span><label for="addChildren" style="vertical-align: middle; margin-top: -1.4em;">&nbsp;<span style="font-weight: normal;">Add Children</span></label>'),n("#incompleteOrdinancesGeneration").change(function(e){var t=n("#incompleteOrdinancesGeneration").val();f.researchType===s.DESCENDANTS?t>1&&i.warning("Selecting two generations of Descendants will more than double the time to retrieve descendants."):t>f.generation&&i.warning("Increasing the number of generations will increase the time to retrieve ancestors."),f.generation=n("#incompleteOrdinancesGeneration").val(),f.resetReportId(n("#incompleteOrdinancesReportId"))})}function v(){var e=[];e[0]="1",e[1]="2",e[2]="3",d(e),n("#incompleteOrdinancesGeneration").val(f.generation)}function m(){var e=[];e[0]="2",e[1]="3",e[2]="4",e[3]="5",e[4]="6",e[5]="7",e[6]="8",d(e),n("#incompleteOrdinancesGeneration").val(f.generation)}function g(){n("#incompleteOrdinancesReportId").val(f.reportId);var e=n("#incompleteOrdinancesReportId option:selected").text();if(e&&e.length>8&&e!=="Select"){var t=e.indexOf("Name: ")+6,r=e.indexOf(", Date:  "),i=e.indexOf(", Research Type: "),o=e.indexOf(",  Generations: ");f.id=e.substring(t,t+8),f.name=e.substring(t+11,r),f.researchType=e.substring(i+17,o),f.generation=e.substring(o+16,o+17),f.loadPersons(n("#incompleteOrdinancesPersonId"))}f.researchType===s.DESCENDANTS?v():m(),p()}function y(e){h.loadReports(n("#incompleteOrdinancesReportId"),e),g()}function b(){f.researchType!==s.ANCESTORS&&(f.generation="2"),n("incompleteOrdinancesGeneration").val(f.generation)}function w(){l.form=n("#incompleteOrdinancesForm"),T(),y(),f.loadPersons(n("#incompleteOrdinancesPersonId")),h.findReport(),p(),r.openForm(l.form,l.formTitleImage,l.spinner)}function E(){f.clear()}function S(){f.reset(),g()}function x(){f.resetReportId(n("#incompleteOrdinancesReportId")),g()}function T(){n("#incompleteOrdinancesPerson").change(function(e){debugger}),n("#incompleteOrdinancesReportId").change(function(e){f.reportId=n("#incompleteOrdinancesReportId option:selected").val(),f.reportId===s.REPORT_ID&&i.warning('Even though the "Select" option is availiable to retrieve family search data, to avoid performance problems it is best practice to first retrieve the data before analyzing.'),g()}),n("#incompleteOrdinancesPersonId").change(function(e){f.id=n("option:selected",n(this)).val(),f.name=n("option:selected",n(this)).text(),h.findReport()?g():x()}),n("#incompleteOrdinancesResearchType").change(function(e){f.researchType=n("#incompleteOrdinancesResearchType").val(),f.researchType===s.DESCENDANTS?(f.generationAncestors=f.generation,f.generation=f.generationDescendants,v()):(f.generationDescendants=f.generation,f.generation=f.generationAncestors,m()),b(),x()}),n("#incompleteOrdinancesFindPersonButton").unbind("click").bind("click",function(){return o.findPerson(e,function(e){var r=t("findPerson");if(e){var i=r.id===n("#incompleteOrdinancesPersonId").val()?!1:!0;i&&(f.id=r.id,f.name=r.name,h.findReport()?g():x()),l.save(),f.loadPersons(n("#incompleteOrdinancesPersonId"))}r.reset()}),!1}),n("#incompleteOrdinancesRetrieveButton").unbind("click").bind("click",function(){return o.retrieve(function(e){var n=t("retrieve");e&&(f.reportId=n.reportId,l.save(),y(!0)),n.reset()}),!1}),n("#incompleteOrdinancesHelpButton").unbind("click").bind("click",function(e){}),n("#incompleteOrdinancesCloseButton").unbind("click").bind("click",function(e){l.form.dialog(s.CLOSE)}),n("#incompleteOrdinancesResetButton").unbind("click").bind("click",function(e){S()}),n("#incompleteOrdinancesPreviousButton").unbind("click").bind("click",function(e){l.previous||window.localStorage&&(l.previous=JSON.parse(localStorage.getItem(s.INCOMPLETE_ORDINANCES_PREVIOUS))),l.previous?(r.initSpinner(l.spinner),l.callerSpinner=l.spinner,n.ajax({url:s.INCOMPLETE_ORDINANCES_REPORT_HTML_URL,success:function(e){var t=n("#incompleteOrdinancesReportForm"),r=t.children().detach();n('<div id="incompleteOrdinancesReportForm"></div>').dialog({title:"Incomplete Ordinances",width:975,open:function(){r.appendTo(t),n(this).css("maxHeight",700)}}),l.displayType="previous",n("#incompleteOrdinancesReportForm").empty().append(e),o&&o.incompleteOrdinancesReportController&&o.incompleteOrdinancesReportController.open()}})):i.message("Sorry, there is nothing previous to display.")}),n("#incompleteOrdinancesSubmitButton").unbind("click").bind("click",function(e){return r.isAuthenticated()?(f.id||i.message("You must first select a person from Family Search"),i.question("Depending on the number of generations you selected, this could take a minute or two.  Select Yes if you want to contine.","Question",function(e){e&&a(["css!/Content/css/lib/research/bootstrap-table.min.css"],function(){},function(){r.initSpinner(l.spinner),l.callerSpinner=l.spinner,n.ajax({url:s.INCOMPLETE_ORDINANCES_REPORT_HTML_URL,success:function(e){var t=n("#incompleteOrdinancesReportForm"),r=t.children().detach();n('<div id="incompleteOrdinancesReportForm"></div>').dialog({title:"Incomplete Ordinances",width:975,height:515,open:function(){r.appendTo(t)}}),c.displayType="start",l.save(),n("#incompleteOrdinancesReportForm").empty().append(e),o&&o.incompleteOrdinancesReportController&&o.incompleteOrdinancesReportController.open()}})})})):(c.form.dialog("close"),r.relogin()),!1}),n("#addChildren").change(function(e){f.addChildren=n("#addChildren").prop("checked"),f.addChildren&&i.warning("Selecting <b>Add Children</b> check box will probably double the time to retrieve ancestors."),f.resetReportId(n("#incompleteOrdinancesReportId")),g()}),n("#incompleteOrdinancesCancelButton").unbind("click").bind("click",function(e){l.form.dialog(s.CLOSE)}),l.form.unbind(s.DIALOG_CLOSE).bind(s.DIALOG_CLOSE,function(e){l.save()})}var n=t("jquery"),r=t("system"),i=t("msgBox"),s=t("constants"),o=t("researchHelper"),u=t("lazyRequire"),a=u.once(),f=t("person"),l=t("incompleteOrdinances"),c=t("incompleteOrdinancesReport"),h=t("retrieve"),N={open:function(){w()}};return o.incompleteOrdinancesController=N,w(),N});