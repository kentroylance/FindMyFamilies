define(["require","jquery","system","msgBox","constants","researchHelper","lazyRequire","person","placeProblems","placeProblemsReport","retrieve","findPerson","retrieve"],function(e){function h(){a.id&&t("#placeProblemsPersonId").val(a.id),a.researchType&&t("#placeProblemsResearchType").val(a.researchType),a.generation&&t("#placeProblemsGeneration").val(a.generation),a.reportId&&t("#placeProblemsReportId").val(a.reportId),a.addChildren&&t("#addChildren").prop("checked",a.addChildren)}function p(e){var n=t('<select class="form-control select1Digit" id="placeProblemsGeneration">');t.each(e,function(e,r){n.append(t("<option/>").attr("value",r).text(r))}),t("#placeProblemsGenerationDiv").empty(),t("#placeProblemsGenerationDiv").append(n),t("#placeProblemsGenerationDiv").nextAll().remove(),a.researchType==="Ancestors"&&a.reportId===i.REPORT_ID&&t("#placeProblemsGenerationDiv").after('<span class="input-group-btn"><input id="addChildren" type="checkbox" style="vertical-align: middle; margin-top: -0.625em; margin-left: .7em;"/></span><label for="addChildren" style="vertical-align: middle; margin-top: -1.4em;">&nbsp;<span style="font-weight: normal;">Add Children</span></label>'),t("#placeProblemsGeneration").change(function(e){var n=t("#placeProblemsGeneration").val();a.researchType===i.DESCENDANTS?n>1&&r.warning("Selecting two generations of Descendants will more than double the time to retrieve descendants."):n>a.generation&&r.warning("Increasing the number of generations will increase the time to retrieve ancestors."),a.generation=t("#placeProblemsGeneration").val(),a.resetReportId(t("#placeProblemsReportId"))})}function d(){var e=[];e[0]="1",e[1]="2",e[2]="3",p(e),t("#placeProblemsGeneration").val(a.generation)}function v(){var e=[];e[0]="2",e[1]="3",e[2]="4",e[3]="5",e[4]="6",e[5]="7",e[6]="8",p(e),t("#placeProblemsGeneration").val(a.generation)}function m(){t("#placeProblemsReportId").val(a.reportId);var e=t("#placeProblemsReportId option:selected").text();if(e&&e.length>8&&e!=="Select"){var n=e.indexOf("Name: ")+6,r=e.indexOf(", Date:  "),s=e.indexOf(", Research Type: "),o=e.indexOf(",  Generations: ");a.id=e.substring(n,n+8),a.name=e.substring(n+11,r),a.researchType=e.substring(s+17,o),a.generation=e.substring(o+16,o+17),a.loadPersons(t("#placeProblemsPersonId"))}a.researchType===i.DESCENDANTS?d():v(),h()}function g(e){c.loadReports(t("#placeProblemsReportId"),e),m()}function y(){a.researchType!==i.ANCESTORS&&(a.generation="2"),t("placeProblemsGeneration").val(a.generation)}function b(){f.form=t("#placeProblemsForm"),x(),g(),a.loadPersons(t("#placeProblemsPersonId")),h(),n.openForm(f.form,f.formTitleImage,f.spinner)}function w(){a.clear()}function E(){a.reset(),m()}function S(){a.resetReportId(t("#placeProblemsReportId")),m()}function x(){t("#placeProblemsPerson").change(function(e){debugger}),t("#placeProblemsReportId").change(function(e){a.reportId=t("#placeProblemsReportId option:selected").val(),a.reportId===i.REPORT_ID&&r.warning('Even though the "Select" option is availiable to retrieve family search data, to avoid performance problems it is best practice to first retrieve the data before analyzing.'),m()}),t("#placeProblemsPersonId").change(function(e){a.id=t("option:selected",t(this)).val(),a.name=t("option:selected",t(this)).text(),S()}),t("#placeProblemsResearchType").change(function(e){a.researchType=t("#placeProblemsResearchType").val(),a.researchType===i.DESCENDANTS?(a.generationAncestors=a.generation,a.generation=a.generationDescendants,d()):(a.generationDescendants=a.generation,a.generation=a.generationAncestors,v()),y(),S()}),t("#placeProblemsFindPersonButton").unbind("click").bind("click",function(n){return s.findPerson(n,function(n){var r=e("findPerson");if(n){var i=r.id===t("#placeProblemsPersonId").val()?!1:!0;i&&(a.id=r.id,a.name=r.name),f.save(),a.loadPersons(t("#placeProblemsPersonId")),i&&S()}r.reset()}),!1}),t("#placeProblemsRetrieveButton").unbind("click").bind("click",function(t){return s.retrieve(function(t){var n=e("retrieve");t&&(a.reportId=n.reportId,f.save(),g(!0)),n.reset()}),!1}),t("#placeProblemsHelpButton").unbind("click").bind("click",function(e){}),t("#placeProblemsCloseButton").unbind("click").bind("click",function(e){f.form.dialog(i.CLOSE)}),t("#placeProblemsResetButton").unbind("click").bind("click",function(e){E()}),t("#placeProblemsPreviousButton").unbind("click").bind("click",function(e){f.previous||window.localStorage&&(f.previous=JSON.parse(localStorage.getItem(i.PLACE_PROBLEMS_PREVIOUS))),f.previous?(n.initSpinner(f.spinner),f.callerSpinner=f.spinner,t.ajax({url:i.PLACE_PROBLEMS_REPORT_HTML_URL,success:function(e){var n=t("#placeProblemsReportForm"),r=n.children().detach();t('<div id="placeProblemsReportForm"></div>').dialog({title:"Place Problems",width:975,open:function(){r.appendTo(n),t(this).css("maxHeight",700)}}),f.displayType="previous",t("#placeProblemsReportForm").empty().append(e),s&&s.placeProblemsReportController&&s.placeProblemsReportController.open()}})):r.message("Sorry, there is nothing previous to display.")}),t("#placeProblemsSubmitButton").unbind("click").bind("click",function(e){return n.isAuthenticated()?(a.id||r.message("You must first select a person from Family Search"),r.question("Depending on the number of generations you selected, this could take a minute or two.  Select Yes if you want to contine.","Question",function(e){e&&u(["jqueryUiOptions","css!/Content/css/lib/research/bootstrap-table.min.css"],function(){},function(){n.initSpinner(f.spinner),f.callerSpinner=f.spinner,t.ajax({url:i.PLACE_PROBLEMS_REPORT_HTML_URL,success:function(e){var n=t("#placeProblemsReportForm"),r=n.children().detach();t('<div id="placeProblemsReportForm"></div>').dialog({title:"Place Problems",width:975,height:515,open:function(){r.appendTo(n)}}),l.displayType="start",f.save(),t("#placeProblemsReportForm").empty().append(e),s&&s.placeProblemsReportController&&s.placeProblemsReportController.open()}})})})):(l.form.dialog("close"),n.relogin()),!1}),t("#addChildren").change(function(e){a.addChildren=t("#addChildren").prop("checked"),a.addChildren&&r.warning("Selecting <b>Add Children</b> check box will probably double the time to retrieve ancestors."),a.resetReportId(t("#placeProblemsReportId")),m()}),t("#placeProblemsCancelButton").unbind("click").bind("click",function(e){f.form.dialog(i.CLOSE)}),f.form.unbind(i.DIALOG_CLOSE).bind(i.DIALOG_CLOSE,function(e){f.save()})}var t=e("jquery"),n=e("system"),r=e("msgBox"),i=e("constants"),s=e("researchHelper"),o=e("lazyRequire"),u=o.once(),a=e("person"),f=e("placeProblems"),l=e("placeProblemsReport"),c=e("retrieve"),T={open:function(){b()}};return s.placeProblemsController=T,b(),T});